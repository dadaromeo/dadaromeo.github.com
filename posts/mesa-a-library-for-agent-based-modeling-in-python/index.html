<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Mesa: A Library for Agent-Based Modeling in Python | Adventures in Dataland</title>
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../../assets/css/screen.css">
<link rel="stylesheet" type="text/css" href="../../assets/css/nav.css">
<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,400%7CInconsolata">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://dadaromeo.github.io/posts/mesa-a-library-for-agent-based-modeling-in-python/">
<link rel="icon" href="../../favicon.ico" sizes="16x16">
<link rel="icon" href="../../favicon-16x16.png" sizes="16x16">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Dada Romeo">
<link rel="prev" href="../the-voice-afrique-tweets-mining-part-4/" title="The Voice Afrique Tweets Mining Part 4" type="text/html">
<link rel="next" href="../automatic-topic-discovery-in-political-blog-posts/" title="Automatic Topic Discovery in Political Blog Posts" type="text/html">
<meta property="og:site_name" content="Adventures in Dataland">
<meta property="og:title" content="Mesa: A Library for Agent-Based Modeling in Python">
<meta property="og:url" content="https://dadaromeo.github.io/posts/mesa-a-library-for-agent-based-modeling-in-python/">
<meta property="og:description" content="In this post, we introduce Mesa a library
written in Python3 for Agent-Based Modeling (ABM). Agent-based modeling
is a growing topic of interest in many scientific disciplines, due to its flexibility
">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-11-30T12:18:31+01:00">
<meta property="article:tag" content="agent-based modeling">
<meta property="article:tag" content="mesa">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@dadaromeo">
<meta name="twitter:creator" content="@dadaromeo">
</head>
<body class="nav-closed">

<div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
<li class="nav-opened" role="presentation">
            <a href="../../">Home</a>
        </li>
        <li class="nav-opened" role="presentation">
            <a href="../../archive.html">Archive</a>
        </li>
        <li class="nav-opened" role="presentation">
            <a href="../../categories/">Tags</a>
        </li>
        <li class="nav-opened" role="presentation">
            <a href="../../rss.xml">RSS feed</a>
        </li>
    
    
    </ul>
</div>
<span class="nav-cover"></span>

<div class="site-wrapper">
    <header class="main-header post-head no-cover"><nav class="main-nav overlay clearfix"><a class="menu-button" href="#"><span class="burger">â˜°</span><span class="word">Menu</span></a>
        </nav></header><main id="content" class="content" role="main"><article class="post post"><header class="post-header"><h1 class="post-title">Mesa: A Library for Agent-Based Modeling in Python</h1>
        <section class="post-meta"> by
            Dada Romeo
            on
                <a href="../../categories/agent-based-modeling/">#agent-based modeling</a>,
                <a href="../../categories/mesa/">#mesa</a>,
            <time class="post-date" datetime="2016-11-30T12:18:31+01:00">
                Nov, 30 2016
            </time></section></header><section class="post-content"><div>
<p>In this post, we introduce <a class="reference external" href="https://github.com/projectmesa/mesa">Mesa</a> a library
written in Python3 for Agent-Based Modeling (ABM). <a class="reference external" href="https://en.wikipedia.org/wiki/Agent-based_model">Agent-based modeling</a>
is a growing topic of interest in many scientific disciplines, due to its flexibility
for modeling complex dynamical systems. Agent-based models (ABMs) consist of autnomous,
interacting computational objets, called agents within a given environment.</p>
<!-- TEASER_END -->
<p>We will introduce the components of of Mesa through a simple foraging model. In this model,
a forager (a bug) walks around, searching for foods. We have three different kind
of food resources: bean, corn and soy. Foods differ from their growth rate, density
on the landscape, and thier starting energy level.</p>
<p>A Mesa model consists of different modules. Here is how the model folder might look:</p>
<blockquote>
<pre class="code bash"><a name="rest_code_32ca23107c9b41fea734411e4209eb70-1"></a>foraging/
<a name="rest_code_32ca23107c9b41fea734411e4209eb70-2"></a><span class="p">|</span>
<a name="rest_code_32ca23107c9b41fea734411e4209eb70-3"></a><span class="p">|</span>---- __init__.py
<a name="rest_code_32ca23107c9b41fea734411e4209eb70-4"></a><span class="p">|</span>
<a name="rest_code_32ca23107c9b41fea734411e4209eb70-5"></a><span class="p">|</span>---- agents.py
<a name="rest_code_32ca23107c9b41fea734411e4209eb70-6"></a><span class="p">|</span>
<a name="rest_code_32ca23107c9b41fea734411e4209eb70-7"></a><span class="p">|</span>---- model.py
<a name="rest_code_32ca23107c9b41fea734411e4209eb70-8"></a><span class="p">|</span>
<a name="rest_code_32ca23107c9b41fea734411e4209eb70-9"></a><span class="p">|</span>---- resources.py
<a name="rest_code_32ca23107c9b41fea734411e4209eb70-10"></a><span class="p">|</span>
<a name="rest_code_32ca23107c9b41fea734411e4209eb70-11"></a><span class="p">|</span>---- server.py
<a name="rest_code_32ca23107c9b41fea734411e4209eb70-12"></a><span class="p">|</span>
<a name="rest_code_32ca23107c9b41fea734411e4209eb70-13"></a><span class="p">|</span>---- utils.py
</pre>
</blockquote>
<p>Without further ado, we specify the components of our foraging model.</p>
<div class="section" id="environment">
<h2>Environment</h2>
<p>One of the component of an ABM system is the <em>Environment</em>. The environment is
where global variables are set up and managed like the number of agents, the scheduler,
or the space where the simulation takes place. In Mesa, the environment is handle
by a the <code class="python"><span class="n">Model</span></code> class. This class takes a seed keyword.
We inherit that class to create our own environment.</p>
<pre class="code bash"><a name="rest_code_721d7c5fca0d419092de21f0eab3b3dc-1"></a>foraging/model.py
</pre>
<pre class="code python"><a name="rest_code_8329bd2d9305455aab3065e027623753-1"></a><span class="kn">from</span> <span class="nn">mesa.model</span> <span class="kn">import</span> <span class="n">Model</span>
<a name="rest_code_8329bd2d9305455aab3065e027623753-2"></a>
<a name="rest_code_8329bd2d9305455aab3065e027623753-3"></a><span class="k">class</span> <span class="nc">Foraging</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
<a name="rest_code_8329bd2d9305455aab3065e027623753-4"></a>
<a name="rest_code_8329bd2d9305455aab3065e027623753-5"></a>    <span class="n">number_of_bean</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_8329bd2d9305455aab3065e027623753-6"></a>    <span class="n">number_of_corn</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_8329bd2d9305455aab3065e027623753-7"></a>    <span class="n">number_of_soy</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_8329bd2d9305455aab3065e027623753-8"></a>
<a name="rest_code_8329bd2d9305455aab3065e027623753-9"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_bug</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<a name="rest_code_8329bd2d9305455aab3065e027623753-10"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<a name="rest_code_8329bd2d9305455aab3065e027623753-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_bug</span> <span class="o">=</span> <span class="n">num_bug</span>
<a name="rest_code_8329bd2d9305455aab3065e027623753-12"></a>        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"stick"</span><span class="p">,</span> <span class="s2">"switch"</span><span class="p">]):</span>
<a name="rest_code_8329bd2d9305455aab3065e027623753-13"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"'strategy' must be one of {stick, switch}"</span><span class="p">)</span>
<a name="rest_code_8329bd2d9305455aab3065e027623753-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
</pre>
<p>The environment defines the <em>space</em> where the agents evolve. The space range from
simple square grid to complex geospatial space. In this post, the agents evolve
within a simple square grid where each colored cell indicades the presence of an
agent and the color indicates the type of agent (we will come to that later).
We add the space in our environment.</p>
<pre class="code bash"><a name="rest_code_37cc3b9c2b384397adf00bf95fde7b8c-1"></a>foraging/model.py
</pre>
<pre class="code python"><a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-1"></a><span class="kn">from</span> <span class="nn">mesa.model</span> <span class="kn">import</span> <span class="n">Model</span>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-2"></a><span class="kn">from</span> <span class="nn">mesa.space</span> <span class="kn">import</span> <span class="n">SingleGrid</span>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-3"></a>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-4"></a><span class="k">class</span> <span class="nc">Foraging</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-5"></a>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-6"></a>    <span class="n">number_of_bean</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-7"></a>    <span class="n">number_of_corn</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-8"></a>    <span class="n">number_of_soy</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-9"></a>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-10"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">torus</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">num_bug</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-11"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_bug</span> <span class="o">=</span> <span class="n">num_bug</span>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-13"></a>        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"stick"</span><span class="p">,</span> <span class="s2">"switch"</span><span class="p">]):</span>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-14"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"'strategy' must be one of {stick, switch}"</span><span class="p">)</span>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-16"></a>
<a name="rest_code_d4dd99e0ac0948899c7e287e2a7ad2d6-17"></a>        <span class="n">sefl</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">SingleGrid</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">torus</span><span class="p">)</span>
</pre>
<p>The environment also defines a <em>scheduler</em> that manages the agents at every time step.
The choice of the type of scheduler is very important since it specifies how
(in which order) the state of the agents is updated. In this post, we use a random
scheduler. It means that at every time step, agents are choose at random at thier
state is updated.</p>
<pre class="code bash"><a name="rest_code_bd3a0b48f2cb4c96ab410c1ba2cae553-1"></a>foraging/model.py
</pre>
<pre class="code python"><a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-1"></a><span class="kn">from</span> <span class="nn">mesa.model</span> <span class="kn">import</span> <span class="n">Model</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-2"></a><span class="kn">from</span> <span class="nn">mesa.space</span> <span class="kn">import</span> <span class="n">SingleGrid</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-3"></a><span class="kn">from</span> <span class="nn">mesa.time</span> <span class="kn">import</span> <span class="n">RandomActivation</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-4"></a>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-5"></a><span class="k">class</span> <span class="nc">Foraging</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-6"></a>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-7"></a>    <span class="n">number_of_bean</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-8"></a>    <span class="n">number_of_corn</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-9"></a>    <span class="n">number_of_soy</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-10"></a>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-11"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">torus</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">num_bug</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-12"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_bug</span> <span class="o">=</span> <span class="n">num_bug</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-14"></a>        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"stick"</span><span class="p">,</span> <span class="s2">"switch"</span><span class="p">]):</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-15"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"'strategy' must be one of {stick, switch}"</span><span class="p">)</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-17"></a>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">SingleGrid</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">torus</span><span class="p">)</span>
<a name="rest_code_6ecb99f6e7da4b1e890ab46ccdc49fff-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">RandomActivation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre>
<p>Since the purpose of an ABM is to study the behaviour of a system under different
conditions, we need a way to collect the relevant data of the system while it is
running. The relevent data in this example being the number of food resources (bean, corn, soy)
and the number of foragers (bug) at each time step. This is handle in Mesa with the
<code class="python"><span class="n">DataCollector</span></code> class.</p>
<pre class="code bash"><a name="rest_code_3f51c9bb23764f69a2eb1010cc3f2504-1"></a>foraging/model.py
</pre>
<pre class="code python"><a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-1"></a><span class="kn">from</span> <span class="nn">mesa.model</span> <span class="kn">import</span> <span class="n">Model</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-2"></a><span class="kn">from</span> <span class="nn">mesa.space</span> <span class="kn">import</span> <span class="n">SingleGrid</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-3"></a><span class="kn">from</span> <span class="nn">mesa.time</span> <span class="kn">import</span> <span class="n">RandomActivation</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-4"></a><span class="kn">from</span> <span class="nn">mesa.datacollection</span> <span class="kn">import</span> <span class="n">DataCollector</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-5"></a>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-6"></a><span class="k">class</span> <span class="nc">Foraging</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-7"></a>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-8"></a>    <span class="n">number_of_bean</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-9"></a>    <span class="n">number_of_corn</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-10"></a>    <span class="n">number_of_soy</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-11"></a>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-12"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">torus</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">num_bug</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-13"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_bug</span> <span class="o">=</span> <span class="n">num_bug</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-15"></a>        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"stick"</span><span class="p">,</span> <span class="s2">"switch"</span><span class="p">]):</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-16"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"'strategy' must be one of {stick, switch}"</span><span class="p">)</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-18"></a>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">SingleGrid</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">torus</span><span class="p">)</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">RandomActivation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-21"></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Bean"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">number_of_bean</span><span class="p">,</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-22"></a>                <span class="s2">"Corn"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">number_of_corn</span><span class="p">,</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-23"></a>                <span class="s2">"Soy"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">number_of_soy</span><span class="p">,</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-24"></a>                <span class="s2">"Bug"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">number_of_bug</span><span class="p">,</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-25"></a>                <span class="p">}</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datacollector</span> <span class="o">=</span> <span class="n">DataCollector</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-27"></a>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-28"></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datacollector</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-31"></a>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-32"></a>        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">exists_empty_cells</span><span class="p">()):</span>
<a name="rest_code_1d6ba0a86faa4e89bca9bd242571d6e3-33"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>
</pre>
<p>The <code class="python"><span class="n">step</span></code> method of the environment run the model by calling the <code class="python"><span class="n">step</span></code>
method of the scheduler which in turn call the <code class="python"><span class="n">step</span></code> method of every agent
which is where the behaviour of the agent is defined.</p>
</div>
<div class="section" id="agents">
<h2>Agents</h2>
<div class="section" id="food">
<h3>Food</h3>
<p>On of the agent in this example is the food resource. In this section, we describe
the behaiour of a food resource.</p>
<p>A food resource starts with a fixed ernergy and grows at a fixed rate. When the
resource is fully frown, it starts to wilt at fixed wilt rate. If the food is fully
grown and its energy reachs a certain treshold, the food replicate itself in an empty
cell in the neighborhood if there is one, otherwise, nothing is done. If a food has
no more energy, it is removed from the environemnt.</p>
<pre class="code bash"><a name="rest_code_4932a80d121f450b9f4bb55b98af0ba3-1"></a>foraging/resources.py
</pre>
<pre class="code python"><a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-1"></a><span class="kn">import</span> <span class="nn">random</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-2"></a>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-3"></a><span class="kn">from</span> <span class="nn">mesa.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-4"></a>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-5"></a><span class="k">class</span> <span class="nc">Food</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-6"></a>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-7"></a>    <span class="n">fully_grown</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-8"></a>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-9"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-10"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">unique_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-12"></a>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-13"></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-14"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fully_grown</span><span class="p">:</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-15"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wilt_rate</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-16"></a>        <span class="k">else</span><span class="p">:</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-17"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">growth_rate</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-18"></a>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-19"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_growth</span><span class="p">:</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-20"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fully_grown</span> <span class="o">=</span> <span class="bp">True</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-21"></a>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-22"></a>        <span class="c1"># new Food</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-23"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fully_grown</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_growth</span><span class="p">):</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-24"></a>            <span class="n">neig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-25"></a>            <span class="n">is_empty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">is_cell_empty</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-26"></a>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-27"></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">is_empty</span><span class="p">,</span> <span class="n">neig</span><span class="p">)):</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-28"></a>                <span class="n">empty</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_empty</span><span class="p">,</span> <span class="n">neig</span><span class="p">))</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-29"></a>                <span class="n">pos</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">empty</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-30"></a>                <span class="n">food_name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-31"></a>                <span class="n">attr_name</span> <span class="o">=</span> <span class="s2">"number_of_{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">food_name</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-32"></a>                <span class="n">last</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-33"></a>                <span class="n">new_food</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-34"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">-=</span> <span class="n">new_food</span><span class="o">.</span><span class="n">energy</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-35"></a>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-36"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">place_agent</span><span class="p">(</span><span class="n">new_food</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-37"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_food</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-38"></a>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-39"></a>        <span class="c1"># Death</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-40"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-41"></a>            <span class="n">food_name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-42"></a>            <span class="n">attr_name</span> <span class="o">=</span> <span class="s2">"number_of_{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">food_name</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-43"></a>            <span class="n">last</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-44"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_remove_agent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-45"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a name="rest_code_4621b952435d42f585cf9c3b1e7c67a4-46"></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="forager">
<h3>Forager</h3>
<p>In this section, we describe the behavior of the forager (bug) in this example.</p>
<p>Each forager borns with a fixed amount of energy, searches for foods in its neighborhood
and moves according to the given strategy (describe below). When a forager moves,
its energy decrease proportionally to the distance between its current position and
the targeted position. When a forager gets old, its energy decreases by a fixed
amount. If a forager is adult (is at a certain age), and its energy level is above a
certain threshold, the forager gives birth in an empty cell in the neighborhood if
there is one, otherwise, moves to a random empty cell eslsewhere if possible. If a
forager has no more energy, it dies (i.e. it's removed from the environment).</p>
<p>In the follwing, is the description of each strategy.</p>
<ul class="simple">
<li>
<strong>Stick</strong>: In this strategy, a forager moves to a random location if there is
nothing around him (no neighbors). Otherwise, stay at its current location.</li>
<li>
<strong>Switch</strong>: In this strategy, at each time step, a forager moves to an empty
location in its neighborhood if there is one, otherwise stay at ist current location.</li>
</ul>
<pre class="code bash"><a name="rest_code_d64c6b4fb2a448208d3860c25c914660-1"></a>foraging/agents.py
</pre>
<pre class="code python"><a name="rest_code_634914b6d0e24bf395cdcf63326392d7-1"></a><span class="kn">import</span> <span class="nn">random</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-2"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-3"></a><span class="kn">from</span> <span class="nn">mesa.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-4"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-5"></a><span class="kn">from</span> <span class="nn">foraging.utils</span> <span class="kn">import</span> <span class="n">euclidean</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-6"></a><span class="kn">from</span> <span class="nn">foraging.resources</span> <span class="kn">import</span> <span class="n">Food</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-7"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-8"></a><span class="k">class</span> <span class="nc">Bug</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-9"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-10"></a>    <span class="n">treshold</span> <span class="o">=</span> <span class="mi">15</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-11"></a>    <span class="n">metabolism</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-12"></a>    <span class="n">energy</span> <span class="o">=</span> <span class="mi">10</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-13"></a>    <span class="n">strategy</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-14"></a>    <span class="n">age</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-15"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-16"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-17"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">unique_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">move</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"stick"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stick</span><span class="p">,</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-20"></a>                    <span class="s2">"switch"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch</span><span class="p">,</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-21"></a>                    <span class="p">}</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-22"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-23"></a><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-24"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-25"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-26"></a>    <span class="n">adult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">5</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-27"></a>    <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">50</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-28"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-29"></a>    <span class="k">if</span> <span class="n">old</span><span class="p">:</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metabolism</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-31"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-32"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">find_food</span><span class="p">()</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-33"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="p">]()</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-34"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-35"></a>    <span class="c1"># new Bug</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-36"></a>    <span class="n">has_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treshold</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-37"></a>    <span class="k">if</span> <span class="n">has_energy</span> <span class="ow">and</span> <span class="p">(</span><span class="n">adult</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-38"></a>        <span class="n">neig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-39"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-40"></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">is_cell_empty</span><span class="p">,</span> <span class="n">neig</span><span class="p">)):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-41"></a>            <span class="n">empty</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">is_cell_empty</span><span class="p">,</span> <span class="n">neig</span><span class="p">))</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-42"></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">empty</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-43"></a>            <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">number_of_bug</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-44"></a>            <span class="n">new_bug</span> <span class="o">=</span> <span class="n">Bug</span><span class="p">(</span><span class="n">last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-45"></a>            <span class="n">new_bug</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-46"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">-=</span> <span class="n">new_bug</span><span class="o">.</span><span class="n">energy</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-47"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">place_agent</span><span class="p">(</span><span class="n">new_bug</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-48"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bug</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-49"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">number_of_bug</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-50"></a>        <span class="k">else</span><span class="p">:</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-51"></a>            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">find_empty</span><span class="p">()</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-52"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-53"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-54"></a>    <span class="c1"># Death</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-55"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-56"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">()</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-57"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-58"></a><span class="k">def</span> <span class="nf">switch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-59"></a>    <span class="n">neig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-60"></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">neig</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-61"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">is_cell_empty</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-63"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-64"></a><span class="k">def</span> <span class="nf">stick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-65"></a>    <span class="n">neig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-66"></a>    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">neig</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-67"></a>        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">find_empty</span><span class="p">()</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-69"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-70"></a><span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-71"></a>    <span class="n">distance</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">euclidean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span><span class="p">))</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-72"></a>    <span class="n">cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metabolism</span> <span class="o">*</span> <span class="n">distance</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-73"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-74"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">move_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-75"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">-=</span> <span class="n">cost</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-76"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-77"></a><span class="k">def</span> <span class="nf">find_food</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-78"></a>    <span class="n">neig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-79"></a>    <span class="k">if</span> <span class="n">neig</span><span class="p">:</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-80"></a>        <span class="n">agent</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">neig</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-81"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">Food</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-82"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eat</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-83"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-84"></a><span class="k">def</span> <span class="nf">eat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">food</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-85"></a>    <span class="n">gain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">metabolism</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-86"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">+=</span> <span class="n">gain</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-87"></a>    <span class="n">food</span><span class="o">.</span><span class="n">energy</span> <span class="o">-=</span> <span class="n">gain</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-88"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-89"></a><span class="k">def</span> <span class="nf">die</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-90"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_remove_agent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-91"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-92"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">number_of_bug</span> <span class="o">-=</span> <span class="mi">1</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-93"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-94"></a><span class="k">class</span> <span class="nc">Bean</span><span class="p">(</span><span class="n">Food</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-95"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-96"></a>    <span class="n">density</span> <span class="o">=</span> <span class="mf">0.005</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-97"></a>    <span class="n">growth_rate</span> <span class="o">=</span> <span class="mi">4</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-98"></a>    <span class="n">wilt_rate</span> <span class="o">=</span> <span class="mi">2</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-99"></a>    <span class="n">max_growth</span> <span class="o">=</span> <span class="mi">20</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-100"></a>    <span class="n">energy</span> <span class="o">=</span> <span class="mi">4</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-101"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-102"></a><span class="k">class</span> <span class="nc">Corn</span><span class="p">(</span><span class="n">Food</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-103"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-104"></a>    <span class="n">density</span> <span class="o">=</span> <span class="mf">0.01</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-105"></a>    <span class="n">growth_rate</span> <span class="o">=</span> <span class="mi">2</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-106"></a>    <span class="n">wilt_rate</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-107"></a>    <span class="n">max_growth</span> <span class="o">=</span> <span class="mi">10</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-108"></a>    <span class="n">energy</span> <span class="o">=</span> <span class="mi">2</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-109"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-110"></a><span class="k">class</span> <span class="nc">Soy</span><span class="p">(</span><span class="n">Food</span><span class="p">):</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-111"></a>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-112"></a>    <span class="n">density</span> <span class="o">=</span> <span class="mf">0.001</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-113"></a>    <span class="n">growth_rate</span> <span class="o">=</span> <span class="mi">20</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-114"></a>    <span class="n">wilt_rate</span> <span class="o">=</span> <span class="mi">10</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-115"></a>    <span class="n">max_growth</span> <span class="o">=</span> <span class="mi">100</span>
<a name="rest_code_634914b6d0e24bf395cdcf63326392d7-116"></a>    <span class="n">energy</span> <span class="o">=</span> <span class="mi">20</span>
</pre>
<p>We can now finish to implement our envionment class with the methods to populate agents.</p>
<pre class="code bash"><a name="rest_code_4e2b42e67d3440139ff2eb73a5c82318-1"></a>foraging/model.py
</pre>
<pre class="code python"><a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-1"></a><span class="kn">from</span> <span class="nn">mesa.model</span> <span class="kn">import</span> <span class="n">Model</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-2"></a><span class="kn">from</span> <span class="nn">mesa.space</span> <span class="kn">import</span> <span class="n">SingleGrid</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-3"></a><span class="kn">from</span> <span class="nn">mesa.time</span> <span class="kn">import</span> <span class="n">RandomActivation</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-4"></a><span class="kn">from</span> <span class="nn">mesa.datacollection</span> <span class="kn">import</span> <span class="n">DataCollector</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-5"></a>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-6"></a><span class="kn">from</span> <span class="nn">foraging.agents</span> <span class="kn">import</span> <span class="n">Bean</span><span class="p">,</span> <span class="n">Corn</span><span class="p">,</span> <span class="n">Soy</span><span class="p">,</span> <span class="n">Bug</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-7"></a>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-8"></a><span class="k">class</span> <span class="nc">Foraging</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-9"></a>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-10"></a>    <span class="n">number_of_bean</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-11"></a>    <span class="n">number_of_corn</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-12"></a>    <span class="n">number_of_soy</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-13"></a>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-14"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">torus</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">num_bug</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-15"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_bug</span> <span class="o">=</span> <span class="n">num_bug</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-17"></a>        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"stick"</span><span class="p">,</span> <span class="s2">"switch"</span><span class="p">]):</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-18"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"'strategy' must be one of {stick, switch}"</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-20"></a>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">SingleGrid</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">torus</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">RandomActivation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-23"></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Bean"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">number_of_bean</span><span class="p">,</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-24"></a>                <span class="s2">"Corn"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">number_of_corn</span><span class="p">,</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-25"></a>                <span class="s2">"Soy"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">number_of_soy</span><span class="p">,</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-26"></a>                <span class="s2">"Bug"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">number_of_bug</span><span class="p">,</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-27"></a>                <span class="p">}</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datacollector</span> <span class="o">=</span> <span class="n">DataCollector</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-29"></a>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-30"></a>        <span class="c1"># create foods</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_populate</span><span class="p">(</span><span class="n">Bean</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-32"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_populate</span><span class="p">(</span><span class="n">Corn</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_populate</span><span class="p">(</span><span class="n">Soy</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-34"></a>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-35"></a>        <span class="c1"># create bugs</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-36"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_bug</span><span class="p">):</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-37"></a>            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">find_empty</span><span class="p">()</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-38"></a>            <span class="n">bug</span> <span class="o">=</span> <span class="n">Bug</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-39"></a>            <span class="n">bug</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-40"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">place_agent</span><span class="p">(</span><span class="n">bug</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-41"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bug</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-42"></a>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-43"></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datacollector</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-46"></a>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-47"></a>        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">exists_empty_cells</span><span class="p">()):</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-48"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-49"></a>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-50"></a>    <span class="k">def</span> <span class="nf">_populate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">food_type</span><span class="p">):</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-51"></a>        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">"number_of_{}"</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-52"></a>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-53"></a>        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-54"></a>        <span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="n">food_type</span><span class="o">.</span><span class="n">density</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">height</span><span class="p">):</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-55"></a>            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">find_empty</span><span class="p">()</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-56"></a>            <span class="n">food</span> <span class="o">=</span> <span class="n">food_type</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-57"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">place_agent</span><span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-58"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">food</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-59"></a>            <span class="n">food_name</span> <span class="o">=</span> <span class="n">food_type</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-60"></a>            <span class="n">attr_name</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">food_name</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-61"></a>            <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-62"></a>            <span class="n">val</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-63"></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<a name="rest_code_190c7c05ff004f3bbdbff6ea02b96106-64"></a>            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</pre>
<p>With all this, we can run our model and examine the results. The way we run a model
with different staring point in Mesa is trough the <code class="python"><span class="n">BactchRunner</span></code> class which
take a model constructor and a dictionnary of the different parameters to run the
model with. But in this post, we will manually run the model and collect the result.</p>
<pre class="code python"><a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-1"></a><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-2"></a>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-3"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-4"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-5"></a>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-6"></a><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm_notebook</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-7"></a><span class="kn">from</span> <span class="nn">foraging.model</span> <span class="kn">import</span> <span class="n">Foraging</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-8"></a>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-9"></a><span class="n">time</span> <span class="o">=</span> <span class="mi">250</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-10"></a>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-11"></a><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">stragegy</span><span class="p">):</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-12"></a>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-13"></a>    <span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s2">"fivethirtyeight"</span><span class="p">):</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-14"></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">"line"</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-15"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Run"</span><span class="p">)</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-16"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Population size"</span><span class="p">)</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-17"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Evolution of bug's population with '{}' strategy"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strategy</span><span class="p">))</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-18"></a>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-19"></a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-20"></a>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-21"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Bean"</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">"Corn"</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">"Soy"</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">"Bug"</span><span class="p">:</span> <span class="p">[]}</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-22"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Foraging</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-23"></a>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-24"></a>    <span class="n">progress</span> <span class="o">=</span> <span class="n">tqdm_notebook</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-25"></a>    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-26"></a>        <span class="n">model</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-27"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">"Bean"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">number_of_bean</span><span class="p">)</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-28"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">"Corn"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">number_of_corn</span><span class="p">)</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-29"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">"Soy"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">number_of_soy</span><span class="p">)</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-30"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">"Bug"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">number_of_bug</span><span class="p">)</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-31"></a>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-32"></a>        <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-33"></a>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-34"></a>    <span class="n">progress</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-35"></a>
<a name="rest_code_bd5c89af3e4a46818da91cca3ff71516-36"></a>    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre>
<p>Run the model with <code class="bash">stick</code> strategy</p>
<pre class="code python"><a name="rest_code_d840e69cd16c443d85a23e10fb22a812-1"></a><span class="n">strategy</span> <span class="o">=</span> <span class="s2">"stick"</span>
<a name="rest_code_d840e69cd16c443d85a23e10fb22a812-2"></a><span class="n">result</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="n">strategy</span><span class="p">)</span>
<a name="rest_code_d840e69cd16c443d85a23e10fb22a812-3"></a>
<a name="rest_code_d840e69cd16c443d85a23e10fb22a812-4"></a><span class="n">show</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">strategy</span><span class="p">)</span>
</pre>
<img alt="foraging stick strategy" class="align-center" src="../../images/foraging_stick.png"><p>Run the model with <code class="bash">switch</code> strategy</p>
<pre class="code python"><a name="rest_code_95a5a8d6949f4bf9b665f404f834803d-1"></a><span class="n">strategy</span> <span class="o">=</span> <span class="s2">"switch"</span>
<a name="rest_code_95a5a8d6949f4bf9b665f404f834803d-2"></a><span class="n">result</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="n">strategy</span><span class="p">)</span>
<a name="rest_code_95a5a8d6949f4bf9b665f404f834803d-3"></a>
<a name="rest_code_95a5a8d6949f4bf9b665f404f834803d-4"></a><span class="n">show</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">strategy</span><span class="p">)</span>
</pre>
<img alt="foraging switch strategy" class="align-center" src="../../images/foraging_switch.png"><p>Mesa has an in-browser visualization feature that allows the user to see the model
at running in the browser. To use that functionality in our example, we add what
follows in our directory.</p>
<pre class="code bash"><a name="rest_code_48f19381e4004344962b6a2f63d279d2-1"></a>foraging/server.py
</pre>
<pre class="code python"><a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-1"></a><span class="kn">from</span> <span class="nn">mesa.visualization.modules</span> <span class="kn">import</span> <span class="n">CanvasGrid</span><span class="p">,</span> <span class="n">ChartModule</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-2"></a><span class="kn">from</span> <span class="nn">mesa.visualization.ModularVisualization</span> <span class="kn">import</span> <span class="n">ModularServer</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-3"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-4"></a><span class="kn">from</span> <span class="nn">foraging.agents</span> <span class="kn">import</span> <span class="n">Bean</span><span class="p">,</span> <span class="n">Corn</span><span class="p">,</span> <span class="n">Soy</span><span class="p">,</span> <span class="n">Bug</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-5"></a><span class="kn">from</span> <span class="nn">foraging.model</span> <span class="kn">import</span> <span class="n">Foraging</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-6"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-7"></a><span class="n">width</span> <span class="o">=</span> <span class="mi">50</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-8"></a><span class="n">height</span> <span class="o">=</span> <span class="mi">50</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-9"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-10"></a><span class="k">def</span> <span class="nf">food_portrayal</span><span class="p">(</span><span class="n">agent</span><span class="p">):</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-11"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-12"></a>    <span class="k">if</span> <span class="n">agent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-13"></a>        <span class="k">return</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-14"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-15"></a>    <span class="n">portrayal</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Shape"</span><span class="p">:</span> <span class="s2">"rect"</span><span class="p">,</span> <span class="s2">"Filled"</span><span class="p">:</span> <span class="s2">"true"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s2">"h"</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s2">"Layer"</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-16"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-17"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Bean</span><span class="p">:</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-18"></a>        <span class="n">portrayal</span><span class="p">[</span><span class="s2">"Color"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"cornflowerblue"</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-19"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-20"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Corn</span><span class="p">:</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-21"></a>        <span class="n">portrayal</span><span class="p">[</span><span class="s2">"Color"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"blueviolet"</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-22"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-23"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Soy</span><span class="p">:</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-24"></a>        <span class="n">portrayal</span><span class="p">[</span><span class="s2">"Color"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"forestgreen"</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-25"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-26"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Bug</span><span class="p">:</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-27"></a>        <span class="n">portrayal</span><span class="p">[</span><span class="s2">"Shape"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"circle"</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-28"></a>        <span class="n">portrayal</span><span class="p">[</span><span class="s2">"Color"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"tomato"</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-29"></a>        <span class="n">portrayal</span><span class="p">[</span><span class="s2">"r"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-30"></a>        <span class="n">portrayal</span><span class="p">[</span><span class="s2">"Layer"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-31"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-32"></a>    <span class="k">return</span> <span class="n">portrayal</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-33"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-34"></a><span class="n">bean</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Label"</span><span class="p">:</span> <span class="s2">"Bean"</span><span class="p">,</span> <span class="s2">"Color"</span><span class="p">:</span> <span class="s2">"cornflowerblue"</span><span class="p">}</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-35"></a><span class="n">corn</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Label"</span><span class="p">:</span> <span class="s2">"Corn"</span><span class="p">,</span> <span class="s2">"Color"</span><span class="p">:</span> <span class="s2">"blueviolet"</span><span class="p">}</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-36"></a><span class="n">soy</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Label"</span><span class="p">:</span> <span class="s2">"Soy"</span><span class="p">,</span> <span class="s2">"Color"</span><span class="p">:</span> <span class="s2">"forestgreen"</span><span class="p">}</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-37"></a><span class="n">bug</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Label"</span><span class="p">:</span> <span class="s2">"Bug"</span><span class="p">,</span> <span class="s2">"Color"</span><span class="p">:</span> <span class="s2">"tomato"</span><span class="p">}</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-38"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-39"></a><span class="n">canvas</span> <span class="o">=</span> <span class="n">CanvasGrid</span><span class="p">(</span><span class="n">food_portrayal</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-40"></a><span class="n">chart_count</span> <span class="o">=</span> <span class="n">ChartModule</span><span class="p">([</span><span class="n">bean</span><span class="p">,</span> <span class="n">corn</span><span class="p">,</span> <span class="n">soy</span><span class="p">,</span> <span class="n">bug</span><span class="p">])</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-41"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-42"></a><span class="n">server</span> <span class="o">=</span> <span class="n">ModularServer</span><span class="p">(</span><span class="n">Foraging</span><span class="p">,</span> <span class="p">[</span><span class="n">canvas</span><span class="p">,</span> <span class="n">chart_count</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Foraging"</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s2">"stick"</span><span class="p">)</span>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-43"></a>
<a name="rest_code_56e20843f7ed4c0f8bf8afa1bdfb8a7f-44"></a><span class="n">server</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
</pre>
<p>Once added, we launch the model at the console like this:</p>
<pre class="code bash"><a name="rest_code_b7bac64693834f2098225167398f60e9-1"></a>$ python3 foraging/server.py
</pre>
<p>When launch, something like the figure below opens up in your browser and you
can press the run button to run the model.</p>
<img alt="foraging board" class="align-center" src="../../images/foraging.png">
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>In this post, we introduce Mesa, an agent-based modeling framework through a
simple foraging model. Mesa is still in its infancy but in the near future,
itends to have the power of a full featured ABM's framework. To have an idea of
what is coming next, you can watch this presentation by <a class="reference external" href="https://twitter.com/JackieKazil">Jackie</a> at PyDataDC 2016.</p>
<div class="youtube-video align-center">
<iframe width="425" height="344" src="https://www.youtube.com/embed/bjjoHji8KUQ?rel=0&amp;hd=1&amp;wmode=transparent"></iframe>
</div>
</div>
</div>
    </section><footer class="post-footer"><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="dadaromeo",
            disqus_url="https://dadaromeo.github.io/posts/mesa-a-library-for-agent-based-modeling-in-python/",
        disqus_title="Mesa: A Library for Agent-Based Modeling in Python",
        disqus_identifier="cache/posts/mesa-a-library-for-agent-based-modeling-in-python.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></footer></article><script>var disqus_shortname="dadaromeo";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script></main><footer class="site-footer clearfix"><section class="poweredby">Contents Â© 2017         <a href="mailto:dada.romy@gmail.com">Dada Romeo</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </section></footer>
</div>

    <script type="text/javascript" src="../../assets/js/jquery.js"></script><script type="text/javascript" src="../../assets/js/jquery.fitvids.js"></script><script type="text/javascript" src="../../assets/js/index.js"></script>
</body>
</html>
